@auto[]
^dbconnect{
	$thread[^table::sql{SELECT * FROM threads WHERE id=$form:fields.thread}]
}

@title[]
/$board.directory/ - ^if(def $thread.title){$thread.title}{$thread.body}

@body[]
^thread_posts[]
^thread_reply[]

@thread_reply[]
<form method="POST">
<table>
	<tbody>
		<tr>
			<td>Name</td>
			<td><input name="author" placeholder="Anonymous"></td>
		</tr>
		<tr>
			<td>Body</td>
			<td colspan="2"><textarea name="comment"></textarea></td>
		</tr>
		<tr>
			<td><input type="submit" value="Post" name="posted"></td>
		</tr>
	</tbody>
</table>
</form>
^if(def $form:comment){
	^dbconnect{
		^void:sql{CALL new_reply(
			'$form:comment',
			^if(def $form:author){'$form:author'}{'Anonymous'},
			$thread.id
		)}
	}
	<p>Reply sent. Click <a href="">here</a> if it has not loaded</p>
}

@thread_posts[][op;replies]
^dbconnect{
	$op[^table::sql{CALL get_thread_op($thread.id)}]
	$replies[^table::sql{CALL get_thread_replies($thread.id)}]
}
^postop[$op;$thread]
^replies.menu{
	^post[$replies]
}